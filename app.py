import os

from tensorflow.keras.models import load_model
from model_test import predict_single_image
from lime_integration import explain_image
import streamlit as st
import numpy as np
from PIL import Image
import matplotlib.pyplot as plt

project_path = os.getcwd()
symbol_path = os.path.join(project_path, 'symbol.JPG')
symbol = Image.open(symbol_path)

page_appearance = """
<style>
[data-testid="stAppViewContainer"] {
  width: 100%;
  height: 100%;
  background-size: cover;
  background-position: center center;
  background-repeat: repeat;
  background-image: url("data:image/svg+xml;utf8,%3Csvg viewBox=%220 0 2000 1400%22 xmlns=%22http:%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cmask id=%22b%22 x=%220%22 y=%220%22 width=%222000%22 height=%221400%22%3E%3Cpath fill=%22url(%23a)%22 d=%22M0 0h2000v1400H0z%22%2F%3E%3C%2Fmask%3E%3Cpath d=%22M0 0h2000v1400H0z%22%2F%3E%3Cg style=%22transform-origin:center center%22 stroke=%22%234c4e72%22 stroke-width=%223.6%22 mask=%22url(%23b)%22%3E%3Cpath fill=%22none%22 d=%22M0 0h61v61H0zM183 0h61v61h-61zM427 0h61v61h-61zM610 0h61v61h-61zM671 0h61v61h-61zM732 0h61v61h-61zM854 0h61v61h-61zM915 0h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7205%22 d=%22M976 0h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1159 0h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e725f%22 d=%22M1281 0h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1342 0h61v61h-61zM1403 0h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72f1%22 d=%22M1464 0h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1525 0h61v61h-61zM1586 0h61v61h-61zM1647 0h61v61h-61zM1708 0h61v61h-61zM1769 0h61v61h-61zM1830 0h61v61h-61zM1891 0h61v61h-61zM1952 0h61v61h-61zM61 61h61v61H61zM122 61h61v61h-61zM183 61h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e728f%22 d=%22M305 61h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M366 61h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e729e%22 d=%22M427 61h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M488 61h61v61h-61zM549 61h61v61h-61zM610 61h61v61h-61zM671 61h61v61h-61zM793 61h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e724d%22 d=%22M854 61h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e724f%22 d=%22M915 61h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1037 61h61v61h-61zM1159 61h61v61h-61zM1220 61h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7246%22 d=%22M1342 61h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1464 61h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7275%22 d=%22M1525 61h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1586 61h61v61h-61zM1647 61h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7256%22 d=%22M1708 61h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7245%22 d=%22M1769 61h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1952 61h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e720a%22 d=%22M0 122h61v61H0z%22%2F%3E%3Cpath fill=%22%234c4e723e%22 d=%22M61 122h61v61H61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M122 122h61v61h-61zM183 122h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7233%22 d=%22M244 122h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e726b%22 d=%22M427 122h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M488 122h61v61h-61zM610 122h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72cb%22 d=%22M671 122h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M793 122h61v61h-61zM1037 122h61v61h-61zM1159 122h61v61h-61zM1220 122h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72ba%22 d=%22M1281 122h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1342 122h61v61h-61zM1403 122h61v61h-61zM1464 122h61v61h-61zM1525 122h61v61h-61zM1586 122h61v61h-61zM1647 122h61v61h-61zM1769 122h61v61h-61zM1830 122h61v61h-61zM1891 122h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7282%22 d=%22M61 183h61v61H61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M305 183h61v61h-61zM488 183h61v61h-61zM549 183h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7245%22 d=%22M610 183h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M671 183h61v61h-61zM732 183h61v61h-61zM793 183h61v61h-61zM854 183h61v61h-61zM976 183h61v61h-61zM1037 183h61v61h-61zM1159 183h61v61h-61zM1281 183h61v61h-61zM1342 183h61v61h-61zM1403 183h61v61h-61zM1464 183h61v61h-61zM1525 183h61v61h-61zM1586 183h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7281%22 d=%22M1647 183h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1708 183h61v61h-61zM1891 183h61v61h-61zM0 244h61v61H0zM61 244h61v61H61zM122 244h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7202%22 d=%22M183 244h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M244 244h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7208%22 d=%22M305 244h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72f5%22 d=%22M366 244h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72a7%22 d=%22M671 244h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M793 244h61v61h-61zM854 244h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7212%22 d=%22M915 244h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M976 244h61v61h-61zM1098 244h61v61h-61zM1159 244h61v61h-61zM1220 244h61v61h-61zM1281 244h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7239%22 d=%22M1342 244h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1464 244h61v61h-61zM1525 244h61v61h-61zM1647 244h61v61h-61zM1708 244h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7210%22 d=%22M1891 244h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1952 244h61v61h-61zM0 305h61v61H0zM122 305h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7295%22 d=%22M244 305h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M305 305h61v61h-61zM427 305h61v61h-61zM488 305h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72c8%22 d=%22M549 305h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M610 305h61v61h-61zM671 305h61v61h-61zM732 305h61v61h-61zM793 305h61v61h-61zM854 305h61v61h-61zM915 305h61v61h-61zM1098 305h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7278%22 d=%22M1159 305h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1220 305h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7232%22 d=%22M1281 305h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1342 305h61v61h-61zM1464 305h61v61h-61zM1525 305h61v61h-61zM1586 305h61v61h-61zM1647 305h61v61h-61zM1708 305h61v61h-61zM1830 305h61v61h-61zM1891 305h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7277%22 d=%22M1952 305h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M0 366h61v61H0zM61 366h61v61H61z%22%2F%3E%3Cpath fill=%22%234c4e7220%22 d=%22M183 366h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72a9%22 d=%22M244 366h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M305 366h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72d8%22 d=%22M427 366h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M488 366h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e728f%22 d=%22M610 366h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72d6%22 d=%22M793 366h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M854 366h61v61h-61zM915 366h61v61h-61zM976 366h61v61h-61zM1098 366h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7277%22 d=%22M1281 366h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1342 366h61v61h-61zM1403 366h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72c2%22 d=%22M1525 366h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1586 366h61v61h-61zM1647 366h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7298%22 d=%22M1708 366h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1769 366h61v61h-61zM1830 366h61v61h-61zM1891 366h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72c6%22 d=%22M61 427h61v61H61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M183 427h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72c6%22 d=%22M244 427h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M305 427h61v61h-61zM366 427h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72f6%22 d=%22M549 427h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M610 427h61v61h-61zM671 427h61v61h-61zM732 427h61v61h-61zM793 427h61v61h-61zM854 427h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72fc%22 d=%22M976 427h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1098 427h61v61h-61zM1220 427h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72a8%22 d=%22M1281 427h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1525 427h61v61h-61zM1586 427h61v61h-61zM1708 427h61v61h-61zM1830 427h61v61h-61zM1891 427h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72a7%22 d=%22M0 488h61v61H0z%22%2F%3E%3Cpath fill=%22none%22 d=%22M122 488h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e729e%22 d=%22M183 488h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M244 488h61v61h-61zM305 488h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e722c%22 d=%22M427 488h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M549 488h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72bd%22 d=%22M610 488h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e721a%22 d=%22M671 488h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1037 488h61v61h-61zM1098 488h61v61h-61zM1220 488h61v61h-61zM1281 488h61v61h-61zM1342 488h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e729c%22 d=%22M1464 488h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1525 488h61v61h-61zM1708 488h61v61h-61zM1769 488h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72c3%22 d=%22M1830 488h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1891 488h61v61h-61zM1952 488h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7260%22 d=%22M0 549h61v61H0z%22%2F%3E%3Cpath fill=%22none%22 d=%22M61 549h61v61H61zM122 549h61v61h-61zM183 549h61v61h-61zM244 549h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72c7%22 d=%22M305 549h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7282%22 d=%22M366 549h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M488 549h61v61h-61zM610 549h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7224%22 d=%22M671 549h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M732 549h61v61h-61zM793 549h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72a2%22 d=%22M915 549h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M976 549h61v61h-61zM1037 549h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7231%22 d=%22M1220 549h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1281 549h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7276%22 d=%22M1342 549h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7220%22 d=%22M1525 549h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72a1%22 d=%22M1769 549h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1891 549h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72f4%22 d=%22M1952 549h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M0 610h61v61H0zM61 610h61v61H61zM122 610h61v61h-61zM183 610h61v61h-61zM305 610h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72fa%22 d=%22M366 610h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M427 610h61v61h-61zM549 610h61v61h-61zM610 610h61v61h-61zM671 610h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e723b%22 d=%22M732 610h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M793 610h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e727f%22 d=%22M854 610h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1037 610h61v61h-61zM1098 610h61v61h-61zM1220 610h61v61h-61zM1281 610h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72f2%22 d=%22M1525 610h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1586 610h61v61h-61zM1708 610h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e727b%22 d=%22M1769 610h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M183 671h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72df%22 d=%22M244 671h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M427 671h61v61h-61zM488 671h61v61h-61zM793 671h61v61h-61zM854 671h61v61h-61zM1037 671h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72fb%22 d=%22M1098 671h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1220 671h61v61h-61zM1342 671h61v61h-61zM1403 671h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72a4%22 d=%22M1464 671h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1525 671h61v61h-61zM1586 671h61v61h-61zM1647 671h61v61h-61zM1769 671h61v61h-61zM1891 671h61v61h-61zM1952 671h61v61h-61zM0 732h61v61H0zM61 732h61v61H61zM122 732h61v61h-61zM183 732h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7273%22 d=%22M244 732h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72e4%22 d=%22M366 732h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M427 732h61v61h-61zM488 732h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e726a%22 d=%22M732 732h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M854 732h61v61h-61zM915 732h61v61h-61zM976 732h61v61h-61zM1037 732h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7201%22 d=%22M1159 732h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1220 732h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72d6%22 d=%22M1342 732h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1403 732h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7224%22 d=%22M1525 732h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7257%22 d=%22M1586 732h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1708 732h61v61h-61zM1769 732h61v61h-61zM1830 732h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72f6%22 d=%22M1891 732h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1952 732h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7207%22 d=%22M0 793h61v61H0z%22%2F%3E%3Cpath fill=%22none%22 d=%22M122 793h61v61h-61zM183 793h61v61h-61zM305 793h61v61h-61zM366 793h61v61h-61zM427 793h61v61h-61zM488 793h61v61h-61zM549 793h61v61h-61zM732 793h61v61h-61zM793 793h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7203%22 d=%22M854 793h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7245%22 d=%22M915 793h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1098 793h61v61h-61zM1159 793h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7229%22 d=%22M1220 793h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1281 793h61v61h-61zM1342 793h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7272%22 d=%22M1464 793h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1525 793h61v61h-61zM1586 793h61v61h-61zM1647 793h61v61h-61zM1708 793h61v61h-61zM1769 793h61v61h-61zM1830 793h61v61h-61zM1891 793h61v61h-61zM0 854h61v61H0z%22%2F%3E%3Cpath fill=%22%234c4e72b0%22 d=%22M61 854h61v61H61z%22%2F%3E%3Cpath fill=%22%234c4e726c%22 d=%22M122 854h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M244 854h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7264%22 d=%22M305 854h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e724b%22 d=%22M366 854h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M427 854h61v61h-61zM488 854h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72dc%22 d=%22M610 854h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M671 854h61v61h-61zM732 854h61v61h-61zM793 854h61v61h-61zM854 854h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e721a%22 d=%22M976 854h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7299%22 d=%22M1037 854h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7228%22 d=%22M1098 854h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1159 854h61v61h-61zM1220 854h61v61h-61zM1281 854h61v61h-61zM1342 854h61v61h-61zM1464 854h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7223%22 d=%22M1586 854h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1647 854h61v61h-61zM1708 854h61v61h-61zM1830 854h61v61h-61zM1891 854h61v61h-61zM1952 854h61v61h-61zM0 915h61v61H0zM183 915h61v61h-61zM244 915h61v61h-61zM427 915h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72cf%22 d=%22M488 915h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7235%22 d=%22M610 915h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M671 915h61v61h-61zM793 915h61v61h-61zM854 915h61v61h-61zM915 915h61v61h-61zM976 915h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e724d%22 d=%22M1220 915h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1281 915h61v61h-61zM1342 915h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7267%22 d=%22M1403 915h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1464 915h61v61h-61zM1525 915h61v61h-61zM1586 915h61v61h-61zM1830 915h61v61h-61zM1891 915h61v61h-61zM1952 915h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e727e%22 d=%22M61 976h61v61H61z%22%2F%3E%3Cpath fill=%22%234c4e7215%22 d=%22M122 976h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M305 976h61v61h-61zM366 976h61v61h-61zM549 976h61v61h-61zM671 976h61v61h-61zM793 976h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7280%22 d=%22M976 976h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72d7%22 d=%22M1159 976h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72fd%22 d=%22M1220 976h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1464 976h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e723a%22 d=%22M1647 976h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e724c%22 d=%22M1769 976h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1830 976h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7288%22 d=%22M1891 976h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7201%22 d=%22M122 1037h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M183 1037h61v61h-61zM244 1037h61v61h-61zM366 1037h61v61h-61zM427 1037h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72d4%22 d=%22M549 1037h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7259%22 d=%22M610 1037h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M671 1037h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7268%22 d=%22M732 1037h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7238%22 d=%22M793 1037h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M854 1037h61v61h-61zM976 1037h61v61h-61zM1220 1037h61v61h-61zM1281 1037h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7282%22 d=%22M1403 1037h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1525 1037h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7299%22 d=%22M1586 1037h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1647 1037h61v61h-61zM1708 1037h61v61h-61zM1769 1037h61v61h-61zM1891 1037h61v61h-61zM1952 1037h61v61h-61zM61 1098h61v61H61zM244 1098h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72f9%22 d=%22M366 1098h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e724f%22 d=%22M427 1098h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M549 1098h61v61h-61zM610 1098h61v61h-61zM671 1098h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7269%22 d=%22M732 1098h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7216%22 d=%22M854 1098h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M976 1098h61v61h-61zM1037 1098h61v61h-61zM1098 1098h61v61h-61zM1159 1098h61v61h-61zM1281 1098h61v61h-61zM1464 1098h61v61h-61zM1525 1098h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72ec%22 d=%22M1647 1098h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1708 1098h61v61h-61zM1769 1098h61v61h-61zM0 1159h61v61H0zM122 1159h61v61h-61zM183 1159h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72be%22 d=%22M305 1159h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M366 1159h61v61h-61zM427 1159h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72a2%22 d=%22M488 1159h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M610 1159h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72e2%22 d=%22M732 1159h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M793 1159h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7205%22 d=%22M915 1159h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1098 1159h61v61h-61zM1342 1159h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e727c%22 d=%22M1464 1159h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1586 1159h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7229%22 d=%22M1769 1159h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1830 1159h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e723d%22 d=%22M1891 1159h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72b7%22 d=%22M61 1220h61v61H61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M244 1220h61v61h-61zM305 1220h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e721c%22 d=%22M610 1220h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M671 1220h61v61h-61zM732 1220h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7249%22 d=%22M793 1220h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M854 1220h61v61h-61zM915 1220h61v61h-61zM1159 1220h61v61h-61zM1220 1220h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7205%22 d=%22M1342 1220h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1403 1220h61v61h-61zM1464 1220h61v61h-61zM1525 1220h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7214%22 d=%22M1586 1220h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1647 1220h61v61h-61zM1769 1220h61v61h-61zM1830 1220h61v61h-61zM1891 1220h61v61h-61zM1952 1220h61v61h-61zM0 1281h61v61H0z%22%2F%3E%3Cpath fill=%22%234c4e72a6%22 d=%22M122 1281h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72ce%22 d=%22M183 1281h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M366 1281h61v61h-61zM427 1281h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7211%22 d=%22M549 1281h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72ed%22 d=%22M610 1281h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M732 1281h61v61h-61zM793 1281h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e725b%22 d=%22M854 1281h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M915 1281h61v61h-61zM976 1281h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72d0%22 d=%22M1037 1281h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1098 1281h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e720a%22 d=%22M1159 1281h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1342 1281h61v61h-61zM1403 1281h61v61h-61zM1464 1281h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72af%22 d=%22M1525 1281h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7239%22 d=%22M1586 1281h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1647 1281h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72d5%22 d=%22M1708 1281h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1769 1281h61v61h-61zM0 1342h61v61H0z%22%2F%3E%3Cpath fill=%22%234c4e7239%22 d=%22M122 1342h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M244 1342h61v61h-61zM549 1342h61v61h-61zM671 1342h61v61h-61zM732 1342h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7260%22 d=%22M854 1342h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M915 1342h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72e0%22 d=%22M976 1342h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1220 1342h61v61h-61zM1281 1342h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e72d1%22 d=%22M1342 1342h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1464 1342h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7243%22 d=%22M1525 1342h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e7201%22 d=%22M1586 1342h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1769 1342h61v61h-61z%22%2F%3E%3Cpath fill=%22%234c4e727a%22 d=%22M1830 1342h61v61h-61z%22%2F%3E%3Cpath fill=%22none%22 d=%22M1952 1342h61v61h-61z%22%2F%3E%3C%2Fg%3E%3Cdefs%3E%3CradialGradient id=%22a%22%3E%3Cstop offset=%220%22 stop-color=%22%23fff%22%2F%3E%3Cstop offset=%221%22 stop-color=%22%23fff%22 stop-opacity=%220%22%2F%3E%3C%2FradialGradient%3E%3C%2Fdefs%3E%3C%2Fsvg%3E");

[data-testid="StyledLinkIconContainer"]{
text-align: center;
font-size: 44px;
} 

[data-testid="stMarkdown"]{
p {
    text-align: center;
} 

[data-testid="stMarkdownContainer"]{
p {
    text-align: center;
} 

[data-testid="element-container"]{
p {
    text-align: center;
} 

}
</style>
<head>
    <link rel="icon" type="image/jpg" href="symbol.JPG">
</head>
"""

st.set_page_config(page_title="NeuraScan", page_icon="🔍")
st.markdown(page_appearance, unsafe_allow_html=True)

st.title("NeuraScan")
st.write("Upload or drag and drop your brain scan here.")

model = load_model("classificationModel.keras")

img = st.file_uploader(label=" ", type=['png', 'jpg', 'jpeg'])

if img is not None:
    img = Image.open(img)
    st.image(img, use_column_width=True)

    img = img.resize((128, 128))
    img = np.asarray(img)
    img = img / 255.0

    # CHECK IF IT ALREADY HAS ALL THE DIMS BEFORE DOING THIS
    if img.shape[-1] == 128:
        img = np.expand_dims(img, axis=-1)
    if img.shape[0] == 128:
        img = np.expand_dims(img, axis=0)

    if img.shape[-1] != 3:
        img = np.repeat(img, 3, axis=3)

    prediction, confidence = predict_single_image(model, img)

    if prediction == "MildDemented":
        prediction = "Mild Demented"
    elif prediction == "NonDemented":
        prediction = "Non-Demented"
    elif prediction == "VeryMildDemented":
        prediction = "Very Mild Demented"
    else:
        prediction = "Moderate Demented"

    st.subheader(f"Prediction is: {prediction}")
    st.subheader(f"Confidence: {round(confidence*100, 4)}%")

    with st.spinner("Generating explanation, please wait..."):
        heatmap, explained_image = explain_image(img, prediction)

    st.spinner(False)

    fig, axes = plt.subplots(1, 2, figsize=(10, 5))

    heatmap_plot = axes[0].imshow(heatmap, cmap='RdBu', vmin=-heatmap.max(), vmax=heatmap.max())
    axes[0].set_title('Heatmap')

    regular_plot = axes[1].imshow(explained_image)
    axes[1].set_title('Explained Image')
    fig.colorbar(heatmap_plot, ax=axes[0])

    for ax in axes:
        ax.set_xticks([])
        ax.set_yticks([])

    fig.suptitle(f"Prediction: {prediction}\nConfidence: {round(confidence*100, 4)}%")

    st.pyplot(fig)

st.subheader("What is NeuraScan?")
st.write("Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.")
